---
layout: post
title: "OSI Layer의 피지컬 계층"
date: 2022-01-02
categories: network
---

# OSI Layer의 피지컬 계층

피지컬 계층으로 네트워크가 구성되면 LAN의 하나의 노드에서 생성 된 프레임을 LAN의 모든 노드로 보내게 된다. 이번 포스팅에서는 피지컬 계층의 네트워크가 어떻게 구성되어있는지, 하나의 노드가 어떻게 모든 노드에게 프레임을 보낼 수 있는지 그리고 프레임을 받은 노드는 어떻게 프레임이 자신의 것인지 판단 할 수 있는지에 대해서 포스팅한다.

## 1. UTP(Unshielded Twisted-pair)케이블

![network-02-01](/public/images/network-02-01.jpeg)

하나의 노드에 또 다른 노드에게 전기 신호를 보내기 위해서는 케이블이 필요하다. 여러 종류의 케이블이 존재하지만 현재 가장 많이 사용되고 있는 케이블은 UTP케이블이다. UTP에서 U는 Unshielded 감싸지지 않았다를 의미하고 TP는 Twisted-pair 꼬였다는 의미이다. 실제로 집에 있는 랜선을 뜯어보면 8개의 줄들이 두개씩 꼬여있는 것을 확인 할 수 있을 것이다. 또 STP 케이블이라고 존재하는데 여기서 S(shielded)를 제외하고 같은 의미의 케이블이다.

<br>

케이블의 종류은 전송속도, 전송방식, 전송거리와 같은 세가지 정보를 통해서 구분된다. 예를 들어 10 Base 5와 같은 케이블에서 첫번째 숫자 10은 케이블의 속도를 나타낸다 이는 10Mbps(Mega Bit Per Second)의 속도를 의미한다. 해당 케이블은 1초에 10 메가 피트의 데이터를 전송 할 수 있는 케이블이다. 그리고 Base는 Baseband용 케이블을 의미하고 Broadband용 케이블을 의미한다. Baseband는 디지털 방식 Broadband는 아날로그 방식이다. 그리고 마지막의 5는 최대통신 거리를 나타내는데 이는 500미터를 의미한다 그러므로 10 Base 5 케이블은 10Mbps의 속도와 디지털 방식으로 최대 500미터까지 통신 할 수 있는 케이블이다.

## 2. NIC(Network Interface Card)

![network-02-02](/public/images/network-02-02.png)

1) NIC란

NIC란 통신 데이터를 케이블로 보내거나 케이블로부터 받는 역할을 한다. 보낼 때는 허브나 스위치 라우터와 같은 통신 장비로 데이터를 보내고 받을 때에는 노드의 cpu에게 데이터를 전달해준다. 이때 보내는 것을 Outbound 들어오는 것을 Inbound라고 한다.

<br>

Outbound 데이터는 허브, 스위치, 라우터 같은 통신 장비가 처리하므로 다음에 포스팅한다. 그래서 Inbound에 대한 과정을 설명하자면 NIC이 외부로 Inbound데이터를 받으면 해당 데이터의 목적지가 자신인지 아닌지 프레임의 헤더를 통해서 확인한다. 목적지가 자신이 아닌 경우는 데이터를 파기한다. 그리고 목적지가 자신이라고 판단되면 NIC는 cpu에게 IRQ(Interrupt request)를 보내어 해당 데이터를 처리해줄 것을 요청한다. 그러면 cpu는 IRQ번호를 통해 해당 요청이 NIC로부터의 요청이라 확인하고 Base Memory(NIC으로부터 요청을 처리하기 위해 할당해놓은 메모리 공간)에 적재하여 데이터를 처리한다. 

2) NIC 카드의 종류

NIC은 아래의 기준에 따라 여러가지 종류가 있다. NIC를 구입 할 때는 자신의 컴퓨터에 맞는 NIC을 구입해야된다.

* LAN의 통신방식

    ex) 이더넷, 토클링, FDDI, ATM 등등

* PC 종류

    ex) 데스크톱, 노트북, 프린터 등등

* 버스방식(컴퓨터 내부에서 데이터가 전송되는 방식)

    ex) PCI, ISA, EISA 등등

* 속도

    ex) 10Mbps용, 100Mbps용 등등

* 케이블 포트

    ex) UTP 등등

3) MAC(Media Access Control) 주소

NIC에는 전세계에서 유일한 48bit의 숫자를 부여받는데 그 숫자들을 맥주소라고 한다. 우리가 편지를 보낼 때 전세계에서 유일한 주소 즉, 집 주소를 사용하는 것처림 맥주소도 어떤 두 노드가 통신하기 위한 유일한 주소를 사용한다. 맥 주소는 Outbound의 경우 NIC에 의해 프레임에 저장되기도 하고 Inbound의 경우 자신에게 여기 온 데이터인지를 판단하는데 쓰이기도 한다.

<br>

맥주소는 48bit의 숫자로 구성되어 있다. 8bit를 1옥텟(octet)으로 6octet의 숫자라고도 한다. 6옥텟 중 3옥텟은 생성자를 나타내는 코드로 OUI(Organizational Unique Identifier)이라고 한다. 즉, NIC만든 회사를 나타낸다. 그리고 나머지 3옥텟는 회사에서 각 장비에 분배되는 Host Identifier이다. 한 마디로 시리얼 넘버이다. 예를 들어 3a:f9:d3:e2:3a:18라는 맥주소가 있다면 3a:f9:d3는 OUI, e2:3a:18 Host Identifier이다.

## 3. 허브(hub)

![network-02-03](/public/images/network-02-03.jpeg)

여러 컴퓨터에 NIC을 설치하고 케이블이 준비되면 여러 컴퓨터와 허브를 케이블을 통해서 연결시키면 LAN을 구축 할 수 있다. 

<br>
1) 허브의 기능

허브는 크게 두 가지 역할을 가진다. 하나는 멀티포트(Multiport)기능이다. 즉, 허브는 여러개의 포트를 가지고 있어서 여러 대의 컴퓨터와 연결된다. 그리하여 하나의 노드가 보낸 통신이 허브에 도착하면 허브는 통신을 보내온 포트를 제외 한 모든 포트에 같은 통신을 보낸다. 통신을 보낸 노드를 제외한 모든 노드의 NIC은 프레임의 목적지 주소를 확인하고 데이터를 폐기하거나 cpu로 보낸다. 이러한 방식을 공유(Shared)방식이라고 한다. 이러한 공유 방식은 프레임의 목적지 주소와 다른 노드에게 까지 통신이 발생하므로 쓸데없는 네트워크 비용이 발생한다는 한계를 가진다.

<br>

두번째는 리퍼터(Repeater)기능이다. 케이블은 정해진 최대 통신 거리가 있어서 최대전송거리 이상의 거리가 되면 리퍼터로 데이터를 리피팅 시켜줘야하는데 허브는 이러한 리피팅을 시켜주는 기능을 가지고 있다.

<br>
2) 허브의 종류

허브는 Dummy허브, Intelligent허브, semi-Intelligent허브등이 있다. 위와 같은 기본적인 허브의 기능만 가지고 있는 허브를 Dummy 허브라고 한다. 하지만 Intelligent은 추가적인 지능적 기능이 있다. 첫번째로 NMS(Network Management System)와 같은 네트워크 관리 시스템으로 관리 되어 질 수 있다. NMS로 관리하면 여러개의 허브를 원격으로 관리 할 수 있다. 두번째로 Isolation(고립)기능이다. 만약 특정 노드에 장애가 발생하여 의미 없는 데이터를 계속 보낸다면 공유방식의 허브는 자신과 연결되어 있는 모든 노드에게 계속 데이터를 보낼 것이므로 상당한 네트워크 비용이 발생하게 된다. 이럴 때 Isolation(고립)기능을 가지고 있는 Intelligent 허브는 특정 노드가 장애가 발생되었다고 판단하여 해당 노드를 나머지 노드로 부터 고립시켜 필요없는 네트워크 비용이 발생하는 것을 차단한다. 추가적으로 Semi-intelligent 허브가 있는데 해당 허브는 단독으로 사용 될 때는 Dummy 허브이다가 Intelligent허브와 연결되어 사용되면 Intelligent 허브가 된다.

## 4. 이더넷(Ethernet)

위에서 설명한 UTP케이블, NIC, 허브가 준비되면 피지컬 계층으로만 구성 된 LAN을 구축 할 수 있다. 이러한 네트워크를 이더넷이라 한다. (이더넷은 물리계층 통한 네트워크이므로 다음에 포스팅할 데이터링크 계층도 포함 될 수 있다.)

<br>

그런데 만약 1번 노드와 2번 노드가 동시에 데이터를 보내면 어떻게 될까? 전기 신호는 아마 충돌되어 올바른 통신이 힘들 것이다. 이러한 충돌을 콜리전(Collision)이라고 한다. 이러한 상황을 햬결하기 위해 많이 이더넷은 CSMA/CD (Carrier Sense Multiple Access / Collision Detection)라는 방식을 사용한다. 그의 방식으로는 토큰링, FDDI, ATM방식이 존재한다. 

<br>

Carrier Sense이란 통신 기기가 현재 자신의 네트워크에 통신이 발생하고 있는지를 감지하는 것이다. 노드는 통신이 발생하고 있는지 없는지를 감지하고 있다가 통신이 발생하지 않는다고 판단되면 자신이 보내야 되는 데이터를 보낸다. 여기서 Carrier란 네트워크 상에 존재하는 데이터를 의미하고 Sence는 감지를 의미한다.

<br>

Carrier Sense를 하고 있는 노드들은 통신이 발생하지 않는다고 판단 될 때 동시에 노드들이 자신의 데이터를 보낼 수 있다. 즉, 노드들이 통신을 보내는 순서가 따로 존재하지 않고 통신이 일어나지 않는다고 판단 될 때 언제라도 통신을 보낼 수 있다는 것 이다. 이러한 방식을 Multiple Access(다중 접근)이라고 한다.

<br>

Multiple Access 방식은 노드들의 콜리전을 발생 시킬 수 있다. 콜리전이 발생되면 노드들은 감지를 하는데 이를 Collision Detection(충돌 감지)이라고 한다. Collision Detection이 발생하면 노드들은 랜덤한 시간동안 기다린 후에 다시 데이터을 보내도록 한다.

<br>

추가적으로 이러한 콜리전이 발생 할 수 있는 영역을 콜리전 도메인(Collision domain)이라고 한다. 허브만으로 구성 된 이더넷에서는 노드들의 증가하면 콜리전 도메인의 영역이 커지고 (위에서 설명한 CSMA/CD과 공유방식을 고려하면) 콜리전 도메인이 커지는만큼 콜리전이 발생 할 확률과 쓸데없는 네트워크 비용이 증가하게된다. 이러한 문제를 해결하기 위해서는 데이더 링크 계층의 브리지와 스위치를 사용해야 한다. 

## 5. 유니캐스트와 브로드캐스트 

이더넷이 구축되면 유니캐스트와 브로드캐스트라는 두가지 통신을 할 수 있다. 유니캐스트에는 이더넷 프레임의 목적지 주소에 특정 NIC의 맥주소를 입력하여 통신하는 것이고 브로드캐스트는 목적지 주소에 FF.FF.FF.FF.FF.FF라는 브로드캐스트용 맥주소를 입력하여 통신하는 것이다.

<br>

유니캐스트는 이더넷 프레임의 목적지 주소에 특정 mac주소를 등록하여 통신한다. 그러면 이더넷 프레임은 허브에 연결되어 있는 모든 노드에게 이더넷 프레임이 보내지게 된다. NIC 카드는 해당 이더넷 프레임의 목적지 맥주소를 보고 자신의 맥주소와 다르면 프레임을 폐기시켜버린다. 하지만 자신의 주소와 같은 경우는 cpu에 인터럽트를 요청하여 이더넷 프레임의 데이터가 노드로 들어 올 수 있도록한다. 

<br>

하지만 브로드 캐스트는 특정 맥 주소를 프레임이 보내지 않고 FFFF.FFFF.FFFF라는 주소를 프레임에 등록하여 모든 노드에게 통신을 보낸다. 그러면 허브에 연결되어 있는 모든 노드의 NIC 카드는 프레임의 맥주소를 보고 cpu에게 패킷을 처리 해줄 것을 요청한다. cpu는 패킷의 내용에 있는 ip주소가 자신의 ip주소 맞는지를 확인하고 처리하든가 다르다면 패킷을 폐기한다. 브로드 캐스트는 cpu에게 무조건 요청을 보내기 때문에 유니캐스트 보다 네트워크 전체적으로 더 많은 비용이 발생한다는 문제가 있다. 이러한 브로드 캐스트 통신의 대표적인 예로는 ARP가 있다.

## 6. ARP(Address Resolution Protocol)

통신이 발생 할 때 ip패킷의 ip주소는 알지만 mac주소가 모르는 경우가 발생 할 수 있다. 개발을 진행하다 보면 다른 노드와의 통신을 위해서 ip주소를 사용하지 mac주소를 사용하지 않기 때문에 기본적으로 통신을 보낼 곳의 맥주소는 알 수가 없다. 이러한 상황에서 노드는 ARP통신을 발생시킨다. 

<br>

ARP가 발생하면 요청을 보내는 노드는 이더넷 프레임 헤더에 출발지 맥주소로 자신의 맥주소를 목적지 맥주소는 브로드캐스트용 맥주소를 입력하고 프레임의 바디에는 목적지 ip주소를 입력하여 브로드캐스트 요청을 보낸다. LAN의 모든 노드들이 프레임을 받고 cpu에게 목적지 ip주소에 대한 확인을 요청한다. ip가 자신의 ip와 같은 경우는 목적지 아이피에 해당하는 맥주소를 입력하여 통신을 보내온 노드에게 반환해준다. 만약 ip가 다르면 프레임을 파기시키고 통신을 종료한다. 결과적으로 하나의 통신을 보낸 노드는 ip에 해당하는 맥주소를 받아 올 수 있다.

<br>

만약 LAN에 ip와 맞는 맥주소가 존재하지 않는다면 라우터가 자신의 맥주소를 입력하여 반환해줄 것이므로 라우터의 맥주소가 반환될 것이다. 라우터에 대한 내용은 네트워크 계층에 대해 호스팅 할 때 설명할 것이다.