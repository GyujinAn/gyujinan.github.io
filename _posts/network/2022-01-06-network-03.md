---
layout: post
title: "OSI Layer의 데이터 링크 계층"
date: 2022-01-06
categories: network
---

# OSI Layer의 데이터 링크 계층

피지컬 계층에서는 전기 신호(bit)를 연결 된 노드들 모두에게 보내는 것이 목표였다면 데이터 링크 계층에서는 프레임을 분석하여 데이터를 특정 노드에게 보내는 것이 목표이다. 데이터 링크 계층의 네트워크 장비는 브릿지(brige)와 스위치(switch)가 있다. 두 장비의 성능의 차이는 있지만 기능적 차이는 없으므로 스위치에 대한 내용만 포스팅한다.

## 1.스위치(switch)

![network-03-01](/public/images/network-03-01.jpeg)

스위치의 주요기능은 포트별로 콜리전 도메인(Collision domain)을 나누는 것이다. 하나의 콜리전 도메인을 사용함으로써 네트워크 속도에 한계를 가지고 있는 허브와 다르게 스위치는 연결 된 각 노드와 독자적(Dedicated)으로 10 Mbps와 같은 속도를 갖출 수 있다. 하지만 만약 네트워크의 각 노드들 간의 통신이 없고 모든 노드들이 라우터를 통해서 인터넷과 통신을 하는 구조라면 사용되는 콜리전 도메인은 하나이므로 허브를 사용하는 것과 비슷한 네트워크 비용이 발생한다. 그러한 점을 고려하여 스위치를 설치 할 것인지 허브를 설치 할 것인지 결정해야 될 것이다.

## 2. 스위치의 원리

허브로만 이루어진 이더넷은 CSMA/CD와 shard 방식을 사용하므로 불필요한 네트워크 비용을 발생시킨다. 스위치는 콜리전 도메인을 나눔으로써 불필요한 네트워크 비용을 없애준다. 스위치가 콜리전 도메인을 나누는 원리는 Learning, Flooding, Forwarding, Filtering, Aging과 같은 과정을 통해서 구현된다. 

1) Learning

Learning은 스위치가 맥주소는 저장하는(배우는) 행위를 의미한다. 스위치는 특정노드로부터 통신을 받게 되면 프레임을 확인하여 해당 노드의 맥주소와 세그먼트(세그멘트란 큰 네트워크를 구성하는 작은 네트워크를 의미하며 여기서는 하나의 콜리전 도메인을 지칭한다.) 정보를 테이블에 저장한다. 저장되는 테이블을 Mac address table이라고 한다.

2) Flooding

스위치 특정노드로 부터 받은 프레임에서 목적지 맥주소를 확인한다. 해당 맥주소의 정보가 맥주소 테이블에 존재하지 않으면 스위치는 프레임을 받은 포트를 제외 한 포트로 broad cast 혹은 multi cast 통신을 시도한다. 이러한 행위를 Flooding(홍수)이라고 한다.

3) Forwarding

스위치가 확인 한 맥주소의 정보가 맥주소 테이블에 존재하면 스위치는 해당 세그먼트(콜리전도메인)으로 통신을 보내준다.

4) Filtering

스위치가 확인한 목적지 맥주소의 세그먼트와 출발지 맥주소가 같은 경우는 스위치는 다른 세그먼트 쪽으로 데이터를 전달되지 않도록 차단한다. Filtering으로 인해서 콜리전도메인을 나눌 수 있는 것이다.

5) Aging

스위치의 맥주소 테이블의 메모리 크기도 정해져 있기 때문에 모든 맥주소를 저장 할 수 없다. 특정 맥주소에 대한 통신이 일정시간 동안 발생하지 않으면 해당 맥주소의 레코드를 삭제한다. 하지만 일정시간 내에 통신이 발생하면 Aging타이머를 refresh함으로써 레코드에 대한 시간을 갱신한다. 

## 3. 스위치의 Looping

1) Fault Tolerant 와 Load Balancing

네트워크에는 항상 장애가 발생 할 수 있다. 예를 들어 케이블 선이 끊어진다거나, 스위치가 고장난다거나 할 수 있을 것이다. 이에 대한 대비책을 마련하는 것을 Fault Tolerant라고 한다. 그리고 많은 통신에 대한 처리를 하나의 통신장비가 처리하기 버거울 수 있는데 이러한 상황에서 여러개의 통신장비를 설치하여 통신에 대한 처리를 분산시키는 것을 Load Balancing이라고 한다.

2) Looping

Fault Tolerant 혹은 Load Balancing를 위해서 여러개의 스위치를 같이 사용하거나 할 수 있다. 이러한 경우 Looping에 대해 고려하지 않으면 네트워크 장애가 발생 할 수 있다. 만약 두개의 콜리전 도메인(A,B)이 두개의 스위치(a,b)에 연결되어 있다고 가장해보자. 

콜리전 도메인A에서 브로드캐스트가 발생하면 스위치a는 브로드캐스트를 받아서 다시 콜리전 도메인B로 브로드캐스트 통신을 보낼 것이다. 스위치 b는 콜리전 도메인B로 부터 브로드 캐스트를 받아서 다서 콜리전 도메인A로 브로드캐스트 통신을 보내게 되면 A -> a -> B -> b -> A -> a .... 이런 식으로 해당 브로드캐스트는 계속 네트워크 상에 남아 장애를 발생 시킬 것이다.

3) 스패닝 트리 알고리즘(Spanning Tree Algorithm)

위와 같은 Looping은 스패닝 트리 알고리즘을 통해서 예방 할 수 있다. 스패닝 트리 알고리즘이란 스위치에서 발생 할 수 있는 루핑을 미리 막기 위해 두개 이상의 경로가 발생하면 하나를 제외하고 나머지 경로를 자동으로 막아두었다가 기존 경로에 문제가 생기면 막아놓은 경로를 풀어서 통신하는 알고리즘이다.
